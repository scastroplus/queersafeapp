# -*- coding: utf-8 -*-
"""VALE OUT25 - Agente LGBT+Gemini.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Hu-ZsMZuLufDeePnwTlDCxFw1z5AAiMR
"""

# C√©lula 1: Instala√ß√£o e Atualiza√ß√£o das Bibliotecas (google-genai)

print("Iniciando instala√ß√£o e atualiza√ß√£o das bibliotecas (modo detalhado)...")
# Instalamos E ATUALIZAMOS as bibliotecas principais.
# Removido googletrans, pois a se√ß√£o de links ser√° removida.

print("Instala√ß√£o/Atualiza√ß√£o conclu√≠da. Verifique a sa√≠da acima para erros ou avisos.")

# C√©lula Extra: Verificar Vers√£o da Biblioteca google-genai

print("Verificando a vers√£o da biblioteca google-genai...")
try:
    except Exception as e:
    print(f"Erro ao verificar a vers√£o: {e}")
    print("Certifique-se de que a C√©lula 1 foi executada corretamente para instalar a biblioteca.")

# C√âLULA 2 - Configura a API Key do Google Gemini

import os
from google.colab import userdata

os.environ["GOOGLE_API_KEY"] = userdata.get('GOOGLE_API_KEY')

# C√©lula 3 Modificada: Define o modelo (Sem criar objeto Client)

# Importamos a biblioteca genai.
from google import genai

print("Definindo o ID do modelo a ser usado...")

# >> USANDO O NOME DO MODELO ESPEC√çFICO QUE VOC√ä QUER TESTAR <<
# Certifique-se de que este nome est√° correto e dispon√≠vel para sua chave de API.
MODEL_ID = "gemini-2.5-flash" # Exemplo. Use o nome que voc√™ verificou.
# Se voc√™ quiser testar o 'gemini-2.0-flash', mude aqui: MODEL_ID = "gemini-2.0-flash"

print(f"ID do Modelo configurado para: {MODEL_ID}")

# N√£o criamos o objeto 'client' nesta vers√£o, pois tentaremos chamar a gera√ß√£o direto do m√≥dulo genai.
# client = genai.Client() # <<<<<<<< REMOVIDO

# C√©lula 4 Corrigida FINAL (V.6): Fun√ß√£o para Interagir com Modelo Gemini e Ferramenta de Busca (Com Client)

# IMPORTA√á√ÉO CORRETA: Importamos o Client da biblioteca que est√° instalada no Colab.
import os
from google import genai
from google.genai import types

# Assumimos que MODEL_ID j√° foi definido na C√©lula 3.

# CONFIGURA√á√ÉO DE BUSCA: Definimos a ferramenta de busca (Google Search) aqui.
SEARCH_TOOL = [
    types.Tool(
        google_search=types.GoogleSearch(
            # O google_search n√£o aceita par√¢metros por padr√£o no novo SDK,
            # apenas a declara√ß√£o de que a ferramenta deve ser usada.
        )
    )
]


# >>> A fun√ß√£o agora aceita o argumento genero <<<
def obter_relatorio_gemini_com_busca(destino, genero):
    """
    Usa um modelo Gemini com a ferramenta de busca para obter informa√ß√µes e gerar um relat√≥rio
    direto e conciso, com nuance baseada na pontua√ß√£o e adaptado ao g√™nero do usu√°rio,
    incluindo pontua√ß√£o, justificativa e se√ß√µes claras.

    Args:
        destino (str): O nome do destino (cidade, estado, pa√≠s).
        genero (str): A identifica√ß√£o de g√™nero fornecida pelo usu√°rio.

    Returns:
        str: O texto do relat√≥rio gerado pelo modelo Gemini, contendo as se√ß√µes esperadas
             e a pontua√ß√£o, ou uma mensagem de erro.
    """
    # Verificamos se a chave da API foi configurada na C√©lula 2
    if os.getenv("GOOGLE_API_KEY") is None:
        return f"ERRO: A chave da API Gemini n√£o foi configurada. N√£o foi poss√≠vel gerar o relat√≥rio para {destino}."

    print(f"\n-> Usando Modelo '{MODEL_ID}' com Ferramenta de Busca para analisar '{destino}' (Com Instru√ß√£o de G√™nero)...\n")

    try:
        # CORRE√á√ÉO CRUCIAL: Criamos o Cliente para acessar as fun√ß√µes da API
        print("   Criando o Cliente API...")
        client = genai.Client()
        print("   Preparando prompt e configura√ß√£o de busca...")

        # Define a instru√ß√£o para adapta√ß√£o de g√™nero
        prompt_gender_instruction = f"""
        A pessoa que solicitou este relat√≥rio se identifica com o seguinte g√™nero: "{genero}".
        Ao gerar o conte√∫do das se√ß√µes do relat√≥rio (Justificativa da Nota, Resumo Geral da Situa√ß√£o, Alertas de Seguran√ßa, Dicas Locais LGBT+), **adapte a linguagem para se adequar a este g√™nero**:
        - Se o g√™nero fornecido for "homem", use pronomes e concord√¢ncias gramaticais no masculino em portugu√™s (ex: "o viajante", "seguro para ele", "bem recebido").
        - Se o g√™nero fornecido for "mulher", use pronomes e concord√¢ncias gramaticais no feminino em portugu√™s (ex: "a viajante", "segura para ela", "bem recebida").
        - **Para qualquer outro g√™nero** (incluindo "transg√™nero", "N√£o-bin√°rio", "Ag√™nero", "G√™nero fluido", ou se o termo fornecido for amb√≠guo, plural ou n√£o listado), **utilize uma linguagem neutra em portugu√™s**. Priorize frases e estruturas que evitem concord√¢ncias de g√™nero expl√≠citas sempre que poss√≠vel (ex: "pessoa viajante", "seguro para essa pessoa", "bem recebide"). Se a linguagem neutra for dif√≠cil de manter em algumas frases, prefira o uso de termos mais gerais que n√£o impliquem g√™nero. Evite pronomes espec√≠ficos de g√™nero (ele/ela) e utilize alternativas neutras ou o nome da pessoa/g√™nero, se apropriado ao contexto.

        """

        # Define o prompt principal para o modelo. (O restante do prompt √© o mesmo)
        prompt_text = f"""Voc√™ √© um agente de IA especializado em seguran√ßa de viagens para pessoas LGBT+.
Sua tarefa √© pesquisar na web (utilizando a ferramenta Google Search dispon√≠vel)
informa√ß√µes sobre a situa√ß√£o atual (priorizando os **√∫ltimos 6 meses**) para pessoas LGBT+ em \"{destino}\".

Utilize a ferramenta de busca para coletar informa√ß√µes sobre os seguintes t√≥picos no destino \"{destino}\":
1. Leis e direitos LGBT+ RECENTES.
2. N√≠vel de seguran√ßa para pessoas LGBT+, incluindo relatos RECENTES (√∫ltimos 6 meses) de viol√™ncia, ass√©dio ou discrimina√ß√£o.
3. Exist√™ncia e atividades RECENTES (√∫ltimos 6 meses) de grupos extremistas (nazistas, neonazistas, fascistas, extrema direita, etc.) E se h√° relatos RECENTES (√∫ltimos 6 meses) de viol√™ncia ou amea√ßas desses grupos contra minorias, incluindo a comunidade LGBT+.
4. Aceita√ß√£o social e cultural RECENTE da comunidade LGBT+, incluindo atitudes gerais em rela√ß√£o a demonstra√ß√µes p√∫blicas de afeto.
5. Informa√ß√µes sobre a comunidade LGBT+ local, espa√ßos seguros (bares, clubes, ONGs, centros, eventos RECENTES).

Ap√≥s coletar e analisar as informa√ß√µes encontradas (especialmente focando na REC√äNCIA), gere um relat√≥rio **DIRETO E CONCISO**.

**Crucialmente:** Ao descrever desafios ou problemas (como rea√ß√µes a demonstra√ß√µes p√∫blicas de afeto), sempre **contextualize-os claramente dentro do panorama geral de seguran√ßa e aceita√ß√£o no destino**.
- Se a **Pontua√ß√£o de Seguran√ßa LGBT-Friendly** for alta (4.0 ou mais), minimize o foco em incidentes isolados ou desafios menores, enfatizando a seguran√ßa e aceita√ß√£o geral. Mencione os desafios apenas como ressalvas menores dentro do contexto positivo.
- Se a pontua√ß√£o for baixa, detalhe os riscos e desafios com mais √™nfase, explicando por que a nota √© baixa.

{prompt_gender_instruction}

O relat√≥rio DEVE conter as seguintes se√ß√µes, usando os t√≠tulos exatos em negrito e duas estrelas `**`, e usando as informa√ß√µes coletadas:

**Pontua√ß√£o de Seguran√ßa LGBT-Friendly:**
Avalie a seguran√ßa e o acolhimento em uma escala **num√©rica de 0.0 a 5.0**.
- 0.0: Extremamente perigoso, criminalizado com pena severa, alta hostilidade.
- 1.0: Muito arriscado, legalmente restritivo, forte discrimina√ß√£o.
- 2.0: Arriscado, poucas/nenhumas prote√ß√µes, discrimina√ß√£o social presente.
- 3.0: Algumas preocupa√ß√µes, seguro com precau√ß√µes; algumas prote√ß√µes/aceita√ß√£o.
- 4.0: Seguro e acolhedor na maior parte, boas prote√ß√µes legais/aceita√ß√£o.
- 5.0: Totalmente seguro, direitos plenos, sociedade acolhedora, cena vibrante.
**Escreva a pontua√ß√£o num√©rica clara e destacada logo abaixo do t√≠tulo \"Pontua√ß√£o de Seguran√ßa LGBT-Friendly:\", no formato: Pontua√ß√£o: X.X/5.**

**Justificativa da Nota:**
Explique CLARAMENTE por que voc√™ deu essa pontua√ß√£o, referenciando as informa√ß√µes encontradas (leis, seguran√ßa, grupos extremistas, aceita√ß√£o, comunidade), **contextualizando desafios dentro da nota geral conforme instru√≠do acima**. O impacto de leis que criminalizam atos LGBT+ (especialmente com pena severa) ou a presen√ßa de grupos extremistas com viol√™ncia deve ser refletido na nota e justificado explicitamente.

**Resumo Geral da Situa√ß√£o:**
Um panorama CONCISO da situa√ß√£o legal, de seguran√ßa e social no destino, **mantendo a nuance e pondera√ß√£o de acordo com a pontua√ß√£o geral e adaptando a linguagem ao g√™nero do usu√°rio**.

**Alertas de Seguran√ßa:**
Quaisquer cuidados espec√≠ficos a serem tomados ou riscos a serem observados com base nas informa√ß√µes, listados de forma clara, **adaptando a linguagem ao g√™nero do usu√°rio**.

**Dicas Locais LGBT+:**
Informa√ß√µes sobre bares, clubes, eventos, ONGs ou bairros conhecidos (se encontrados), listados de forma clara, **adaptando a linguagem ao g√™nero do usu√°rio**.

Foque na clareza, precis√£o e na REC√äNCIA das informa√ß√µes ao gerar o relat√≥rio e a pontua√ß√£o. Se a busca n√£o retornar informa√ß√µes recentes relevantes para um t√≥pico (especialmente sobre grupos extremistas e viol√™ncia), mencione a falta de dados recentes para esse ponto.

N√£o use emojis de arco-√≠ris no corpo principal do relat√≥rio gerado por voc√™; apenas forne√ßa a pontua√ß√£o num√©rica, a justificativa clara e o conte√∫do das se√ß√µes no formato solicitado. A convers√£o para emojis ser√° feita pelo meu c√≥digo Python.
"""

        print("   Enviando prompt para o modelo e aguardando resposta (isso pode levar um tempo, o modelo est√° usando a busca)...\n")

        # Chamada CORRIGIDA: Chamamos a fun√ß√£o generate_content a partir do objeto 'client'
        response = client.models.generate_content(
            model=MODEL_ID,
            contents=[{"role": "user", "parts": [{"text": prompt_text}]}],
            config={"tools": SEARCH_TOOL}
        )

        # Verifica se a resposta tem texto v√°lido.
        if response and hasattr(response, 'text'):
             # Mantido para debug durante o desenvolvimento. Em uma aplica√ß√£o real, seria removido.
             print("\n--- Resposta Crua do Modelo (para depura√ß√£o) ---")
             print(response.text)
             print("-----------------------------------------------\n")
             return response.text # Retorna o texto gerado pelo modelo
        else:
             # Retorna mensagens de erro que seriam exibidas no frontend
             if response and hasattr(response, 'candidates') and response.candidates and response.candidates[0].finish_reason:
                 return f"N√£o foi poss√≠vel gerar o relat√≥rio. Motivo da finaliza√ß√£o do modelo: {response.candidates[0].finish_reason}. Conte√∫do de seguran√ßa ou outro problema."
             elif response:
                 return f"N√£o foi poss√≠vel gerar o relat√≥rio. O modelo retornou uma resposta inesperada ou vazia para '{destino}'. Resposta raw: {response}"
             else:
                 return f"N√£o foi poss√≠vel gerar o relat√≥rio. Resposta do modelo foi None."


    except Exception as e:
        # Retorna mensagem de erro t√©cnico que seria exibida no frontend
        return f"ERRO: N√£o foi poss√≠vel gerar o relat√≥rio para '{destino}' devido a um problema na intera√ß√£o com a API Gemini/busca: {e}"

# C√©lula 5 Final: Fun√ß√£o para Exibir Relat√≥rio Final (Extra√ß√£o Robusta, Emojis e Ordem Final Sem Links)
# Esta c√©lula n√£o foi alterada nesta rodada de modifica√ß√µes.

import re # Importamos re para extrair informa√ß√µes
import math # Importamos math para arredondamento
from datetime import datetime # Importamos datetime
# Removida a importa√ß√£o de googletrans

def extrair_secao(texto, titulo_secao):
    """
    Extrai o texto de uma se√ß√£o espec√≠fica do relat√≥rio do modelo, dado o t√≠tulo da se√ß√£o.

    Args:
        texto (str): O texto completo do relat√≥rio do modelo.
        titulo_secao (str): O t√≠tulo exato da se√ß√£o a ser extra√≠da (ex: "**Justificativa da Nota:**").

    Returns:
        str: O conte√∫do da se√ß√£o encontrada, ou uma string vazia se a se√ß√£o n√£o for encontrada.
    """
    # A regex procura pelo t√≠tulo da se√ß√£o (com ou sem ':'), captura o conte√∫do at√© o pr√≥ximo t√≠tulo em negrito ou at√© o fim.
    # Usa re.escape para tratar caracteres especiais no t√≠tulo.
    # Adicionado \s* para flexibilidade de espa√ßo ap√≥s o t√≠tulo e poss√≠vel ':'.
    # A lookahead (?=\n\*\*) busca a pr√≥xima se√ß√£o que come√ßa com ** no in√≠cio de uma nova linha.
    # O .*? captura qualquer caractere (incluindo newlines por causa de re.DOTALL) de forma n√£o gananciosa.
    # Adicionado (?:(?=\n\*\*)|$) para garantir que a se√ß√£o termine antes do pr√≥ximo t√≠tulo ** ou no fim da string $.
    # Note: A regex de extra√ß√£o continua usando os t√≠tulos como pedidos no prompt da C√©lula 4 (ex: "**Justificativa da Nota:**").
    # A altera√ß√£o do texto do cabe√ßalho √© apenas na exibi√ß√£o.
    regex = rf'{re.escape(titulo_secao)}:?\s*(.*?)(?:(?=\n\*\*)|$)'
    match = re.search(regex, texto, re.DOTALL)
    if match:
        # Retorna o conte√∫do capturado, removendo espa√ßos/quebras de linha extras no in√≠cio/fim
        return match.group(1).strip()
    return "" # Retorna string vazia se a se√ß√£o n√£o for encontrada


def exibir_relatorio_final(texto_relatorio_do_modelo, destino):
    """
    Exibe o relat√≥rio gerado pelo modelo, extrai a pontua√ß√£o e se√ß√µes,
    adiciona a classifica√ß√£o com emojis refinados e o disclaimer, e reordena a exibi√ß√£o
    com os novos textos e formata√ß√µes.

    Args:
        texto_relatorio_do_modelo (str): O texto do relat√≥rio gerado pelo modelo Gemini,
                                         que deve conter a pontua√ß√£o e se√ß√µes.
        destino (str): O nome do destino (para o t√≠tulo do relat√≥rio).
    """
    # >>> T√≠tulo do Relat√≥rio Final Atualizado <<<
    print(f"O que sabemos sobre {destino.capitalize()}\n") # Removidos os '---' e ajustado o texto

    # >>> R√≥tulo da Data Atualizado <<<
    print(f"Data da busca: {datetime.now().strftime('%Y-%m-%d')}\n")

    # >>> DEBUG: Imprime a resposta crua do modelo para an√°lise <<<
    # Mantido para debug durante o desenvolvimento. Em uma aplica√ß√£o real, seria removido.
    print(f"DEBUG: Texto completo do modelo recebido para an√°lise:\n---\n{texto_relatorio_do_modelo}\n---\n")

    pontuacao = None
    justificativa_nota = ""
    resumo_geral = ""
    alertas_seguranca = ""
    dicas_locais = ""

    # --- Tenta extrair a pontua√ß√£o num√©rica do texto do modelo (BUSCA ULTRA ROBUSTA) ---\n
    # Procura pelo padr√£o "Pontua√ß√£o: X.X/5" em QUALQUER lugar do texto do modelo.
    # Usamos uma regex flex√≠vel que busca pela palavra "Pontua√ß√£o" (com ou sem acento), seguida por ":" e o n√∫mero X.X/5.
    # Isso deve capturar a pontua√ß√£o mesmo que o modelo varie um pouco na formata√ß√£o ao redor.
    match_pontuacao = re.search(r'Pontua(?:√ß√£o|cao)?:\s*(\d+(?:[.,]\d*)?)\s*/5', texto_relatorio_do_modelo, re.IGNORECASE)

    # >>> Debugging score extraction <<<
    # Mantido para debug. Em uma aplica√ß√£o real, seria removido.
    print(f"DEBUG: Resultado da busca regex por pontua√ß√£o (global e robusta): {match_pontuacao}\n") # Print the match object

    pontuacao_str = None
    if match_pontuacao:
        # Se o padr√£o foi encontrado, extra√≠mos a string do n√∫mero
        pontuacao_str = match_pontuacao.group(1)
        # Substitui v√≠rgula por ponto para garantir que float() funcione, caso o modelo use v√≠rgula.
        pontuacao_str = pontuacao_str.replace(',', '.')
        # Mantido para debug. Em uma aplica√ß√£o real, seria removido.
        print(f"DEBUG: String num√©rica raw extra√≠da: '{pontuacao_str}'\n")

    if pontuacao_str:
        try:
            pontuacao = float(pontuacao_str)
            pontuacao = max(0.0, min(pontuacao, 5.0))
            # Mantido para debug. Em uma aplica√ß√£o real, seria removido.
            print(f"DEBUG: Pontua√ß√£o num√©rica '{pontuacao_str}' extra√≠da e convertida: {pontuacao:.1f}\n")
        except ValueError:
            pontuacao = None
             # Mantido para debug. Em uma aplica√ß√£o real, seria removido.
            print(f"DEBUG: Erro ao converter a string '{pontuacao_str}' para float.\n")
    else:
        pontuacao = None # Garante que pontuacao √© None se a string num√©rica n√£o foi extra√≠da ou o match falhou
        # Mantido para debug. Em uma aplica√ß√£o real, seria removido.
        print("DEBUG: N√£o foi poss√≠vel extrair a pontua√ß√£o num√©rica do texto do modelo.\n")


    # --- Converte a pontua√ß√£o num√©rica para emojis de arco-√≠ris (L√≥gica Refinada) ---\n
    emojis = "üö´" # Default para üö´ se a pontua√ß√£o n√£o for extra√≠da ou for 0.0
    if pontuacao is not None: # S√≥ gera emojis se a pontua√ß√£o foi extra√≠da com sucesso
        if pontuacao > 0.0: # Se a pontua√ß√£o √© > 0, gera emojis de arco-√≠ris
            pontuacao_arredondada = round(pontuacao * 2) / 2.0 # Arredonda para o 0.5 mais pr√≥ximo

            num_arco_iris_completos = int(pontuacao_arredondada)
            # Verifica se a parte decimal arredondada √© 0.5 (considerando imprecis√µes de float)
            tem_meio_emoji = abs(pontuacao_arredondada - num_arco_iris_completos - 0.5) < 1e-9

            emojis = "üåà" * num_arco_iris_completos # Adiciona emojis completos

            if tem_meio_emoji:
                 emojis += "¬Ωüåà" # Adiciona meio emoji se necess√°rio
        # else: emojis j√° √© "üö´" por default para pontua√ß√£o 0.0

    # --- Exibe a Pontua√ß√£o e Emojis (PRIMEIRO NA ORDEM) ---\n
    # >>> R√≥tulo da Pontua√ß√£o e Mensagem de Indisponibilidade Atualizados <<<
    # Exibe a pontua√ß√£o e os emojis gerados (ou default)
    if pontuacao is not None:
         print(f"Pontua√ß√£o LGBT+ Friendly: {pontuacao:.1f}/5 {emojis}\n")
    else:
         # Se a pontua√ß√£o n√£o foi extra√≠da (pontuacao is None), exibe a mensagem atualizada com o default de emoji
         print(f"Pontua√ß√£o LGBT+ Friendly: indispon√≠vel {emojis}\n") # emojis ser√° üö´ aqui


    # --- Extrai o conte√∫do de cada se√ß√£o usando a fun√ß√£o auxiliar ---\n
    # Extrai o conte√∫do de cada se√ß√£o esperada, usando a regex que procura o t√≠tulo em negrito.
    justificativa_nota = extrair_secao(texto_relatorio_do_modelo, "**Justificativa da Nota:**")
    # Note: O prompt pede "**Resumo Geral da Situa√ß√£o:**", mas o cabe√ßalho de exibi√ß√£o ser√° "**Vis√£o geral**"
    resumo_geral = extrair_secao(texto_relatorio_do_modelo, "**Resumo Geral da Situa√ß√£o:**")
    alertas_seguranca = extrair_secao(texto_relatorio_do_modelo, "**Alertas de Seguran√ßa:**")
    dicas_locais = extrair_secao(texto_relatorio_do_modelo, "**Dicas Locais LGBT+:**")


    # --- Exibe as se√ß√µes na NOVA ORDEM DESEJADA (Sem Links e Sem Fallbacks) ---
    # Ordem: Pontua√ß√£o/Emojis -> Resumo Geral -> Justificativa -> Alertas -> Dicas Locais -> Disclaimer

    # 1. Resumo Geral da Situa√ß√£o (SEGUNDO NA ORDEM) - >>> Cabe√ßalho Atualizado e em Negrito <<<
    if resumo_geral: # S√≥ exibe a se√ß√£o se o conte√∫do foi extra√≠do
         print("\n**Vis√£o geral**\n")
         print(resumo_geral)
    # Removido o else com mensagem de fallback


    # 2. Justificativa da Nota (TERCEIRO NA ORDEM) - >>> Cabe√ßalho Atualizado e em Negrito <<<
    if justificativa_nota: # S√≥ exibe a se√ß√£o se o conte√∫do foi extra√≠do
         print("\n**Justificativa da nota**\n") # Texto do cabe√ßalho ajustado para min√∫scula 'n' conforme pedido
         print(justificativa_nota)
    # Removido o else com mensagem de fallback

    # 3. Alertas de Seguran√ßa (QUARTO NA ORDEM) - >>> Cabe√ßalho Atualizado e em Negrito <<<
    if alertas_seguranca: # S√≥ exibe a se√ß√£o se o conte√∫do foi extra√≠do
         print("\n**Alertas de Seguran√ßa**\n")
         print(alertas_seguranca)
    # Removido o else com mensagem de fallback

    # 4. Dicas Locais LGBT+ (QUINTO NA ORDEM) - >>> Cabe√ßalho Atualizado e em Negrito <<<
    if dicas_locais: # S√≥ exibe a se√ß√£o se o conte√∫do foi extra√≠do
         print("\n**Dicas Locais LGBT+**\n")
         print(dicas_locais)
    # Removido o else com mensagem de fallback


    # Removido o separador final "--- Fim do Relat√≥rio ---"

    # >>> Texto do Disclaimer Atualizado <<<
    print("\n\nDISCLAIMER: Este relat√≥rio foi gerado por um agente de IA utilizando um modelo Gemini e buscas na web com base em publica√ß√µes dos √∫ltimos 6 meses. A precis√£o e completude dependem das informa√ß√µes encontradas pela ferramenta de busca e da capacidade do modelo em interpret√°-las e sintetiz√°-las. A pontua√ß√£o √© baseada na interpreta√ß√£o do modelo e das informa√ß√µes encontradas. A situa√ß√£o em um destino pode mudar rapidamente. Sempre fa√ßa sua pr√≥pria pesquisa adicional, consulte fontes oficiais de viagem e avalie os riscos com base nas suas circunst√¢ncias pessoais pessoais antes de viajar.") # Corrigido o "pessoais pessoais" para "circunst√¢ncias pessoais"

# C√©lula 6: Fluxo Principal do Agente (Com Input de G√™nero)

# Importamos a fun√ß√£o que obt√©m o relat√≥rio com busca
from __main__ import obter_relatorio_gemini_com_busca
# Importamos a fun√ß√£o que exibe o relat√≥rio final
from __main__ import exibir_relatorio_final
# Importamos input para intera√ß√£o com o usu√°rio
from builtins import input


def executar_agente_gemini_completo():
    """
    Orquestra a execu√ß√£o completa do agente: pede g√™nero, pede destino,
    obt√©m relat√≥rio e exibe o resultado.
    """
    # Textos de Boas-Vindas
    print("SEJA BEM VIADE") # Mantendo a altera√ß√£o que voc√™ fez
    print("Este √© o RADAR QUEER SEGURO")
    print("A sua ferramenta de busca em IA e Google para encontrar locais seguros para viajar")

    # >>> Novo Input para G√™nero <<<
    genero = input("\nDiga com qual g√™nero voc√™ se identifica: ")

    # R√≥tulo para entrada do usu√°rio
    destino = input("Digite qual cidade, estado ou pa√≠s voc√™ quer conhecer: ") # Removido o \n inicial aqui, pois o anterior j√° tem.

    print(f"\nSolicitando relat√≥rio para: {destino}")

    # Obt√©m o relat√≥rio do modelo (chama a fun√ß√£o da C√©lula 4)
    # >>> Passando a vari√°vel genero para a C√©lula 4 <<<
    relatorio = obter_relatorio_gemini_com_busca(destino, genero)

    if relatorio.startswith("ERRO:"):
        # Exibe a mensagem de erro retornada pela C√©lula 4
        print("\nHouve um erro ao obter o relat√≥rio:") # Mantido este cabe√ßalho para o erro
        print(relatorio) # Exibe a mensagem de erro espec√≠fica retornada pela C√©lula 4
    else:
        # Processa e exibe o relat√≥rio final (chama a fun√ß√£o da C√©lula 5)
        print("\nProcessando e exibindo relat√≥rio...") # Mantida mensagem de processamento
        exibir_relatorio_final(relatorio, destino)

# Executa o agente completo ao rodar a c√©lula
executar_agente_gemini_completo()



